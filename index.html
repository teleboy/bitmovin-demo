<script type="text/javascript"
        src="https://cdn.bitmovin.com/player/web/8/bitmovinplayer.js"></script>
<script type="text/javascript"
        src="https://cdn.bitmovin.com/analytics/web/beta/2/bitmovinanalytics.min.js"></script>
<link rel="stylesheet" href="https://cdn.bitmovin.com/player/web/8/bitmovinplayer-ui.css">

<div class="description">
    <p>
        This demo showcases the Bitmovin Player’s ad insertion capabilities. The player can be used with different
        advertising standards, namely VAST, VPAID, IMA and VMAP.
    </p>
    <p>
        Simply schedule your ads at different times of the video by choosing an advertisement standard and providing the
        link
        to the ad tag in the text area. Use the “schedule ads” button to insert the ad, and the “reset
        configuration” button to clear previous scheduled ads.
    </p>
    <p>
        This demo has a pre-roll ad scheduled by default. If you do not want to see these ads, reset the configuration
        before playing the video.
    </p>
</div>

<div id="blocker-wrapper">
    <a href="ssai" title="Bitmovin Server Side Ad Insertion">
        <div id="blocker-info"></div>
    </a>
</div>

<div class="controls">
    <div class="row">
        <div class="col-sm-6 mb-3">
            <select id="adType" class="form-control">
                <option selected="selected" value="vast">VAST</option>
                <option value="vpaid">VPAID</option>
                <option value="vmap">VMAP</option>
            </select>
        </div>
        <div class="col-sm-6 mb-3">
            <select id="schedule-list" class="form-control">
                <option selected="selected" value="pre">Ad position : pre-roll (0%)</option>
                <option value="5%">Ad position : mid-roll(5%)</option>
                <option value="10%">Ad position : mid-roll(10%)</option>
                <option value="post">Ad position : post-roll (100%)</option>
            </select>
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-sm-12">
            <input id="ad-server-url" type="text" class="form-control"
                   placeholder="Custom ad server URL, if empty default will be used">
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12 text-right">
            <input id="scheudle-ad-button" class="btn btn-success mr-3 mt-2" type="button" value="Schedule AD">
            <input id="reset-button" class="btn btn-warning mt-2" type="button" value="Reset Configuration">
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div id="ad-error"></div>
    </div>
    <div class="col-md-12">
        <div id="ad-warning"></div>
    </div>
</div>

<div class="row mt-3">
    <div class="col-md-6 col-sm-12">
        <div id="player" class="no-frame">
            <div id="player-container"></div>
        </div>
    </div>
    <div class="col-md-6 col-sm-12">
        <div id="dynamic-code">
            <h2>Schedule an ad during playback</h2>
            <p>Use the Bitmovin Player's API to schedule ads during playback:</p>
            <script>

                var adBreak1 = {
                    tag: {
                        url: 'https://api-test.adportal.ch/player?action=Replay&channelid=rtlnitro&Uniquehandle=sh&originaldatetime=2021-01-24T13:45:00Z&APIKey=C5BFF7F0-B4DF-475E-A331-F737424F013C',
                        type: 'vast'
                    },
                    id: 'Ad1',
                    position: 'pre',
                    skippableAfter: 10,
                    linearAdUiConfig: {
                        message: 'This ad will end in {remainingTime}',
                        untilSkippableMessage: 'This ad is skippable in {remainingTime}',
                        skippableMessage: 'You can skip this ad now.',
                        requestsUi: true
                    },
                };

                var source = {
                    "title": "Default Demo Source Config",
                    "dash": "https://bitmovin-a.akamaihd.net/content/MI201109210084_1/mpds/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.mpd",
                    "hls": "https://bitmovin-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8",
                    "poster": "https://bitmovin-a.akamaihd.net/content/MI201109210084_1/poster.jpg"
                };

                var playerConfig = {
                    "key": "d94cfbfe-829f-4f35-8f98-8b0b1a784647",
                    "playback": {
                        "muted": true,
                        "autoplay": true
                    }};

                document.querySelector('#scheudle-ad-button').addEventListener('click', loadConfig);
                document.querySelector('#reset-button').addEventListener('click', removeSchedule);

                var playerContainer = document.getElementById('player-container');
                bitmovin.player.Player.addModule(bitmovin.analytics.PlayerModule);
                var player = new bitmovin.player.Player(playerContainer, playerConfig);

                player.load(source);

                function resetAdError() {
                    document.querySelector('#ad-error').innerHTML = '';
                }

                function loadConfig() {
                    resetAdError();
                    var adType = document.getElementById('adType').value || 'vast';
                    var adTagType = adType;

                    var schedule = document.getElementById('schedule-list').value;
                    if (schedule) {
                        var manifestUrl = document.getElementById('ad-server-url').value;
                        if (!manifestUrl) {
                            switch (adType) {
                                case 'vmap': {
                                    manifestUrl = '//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/ad_rule_samples&ciu_szs=300x250&ad_rule=1&impl=s&gdfp_req=1&env=vp&output=vmap&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ar%3Dpreonly&cmsid=496&vid=short_onecue&correlator=[random]';
                                    adTagType = 'vmap';
                                    break;
                                }
                                case 'vpaid': {
                                    manifestUrl = '//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dlinearvpaid2js&correlator=[random]';
                                    adTagType = 'vast';
                                    break;
                                }
                                default: {
                                    // reset to VAST
                                    manifestUrl = '//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dlinear&correlator=[random]';
                                    adTagType = 'vast';
                                    document.getElementById('adType').value = 'vast';
                                }
                            }
                        }

                        player.ads.schedule({
                            tag: {
                                url: manifestUrl,
                                type: adTagType
                            },
                            id: 'Ad',
                            position: document.getElementById('schedule-list').value
                        });
                    }
                    player.play();
                }

                function removeSchedule() {
                    resetAdError();

                    if (player.ads) {
                        var activeAd = player.ads.getActiveAdBreak();
                        var adArray = player.ads.list();

                        if (adArray.length != 0) {
                            adArray.forEach(function (element) {
                                player.ads.discardAdBreak(element.id);
                            });
                        }

                        if (activeAd) {
                            player.ads.discardAdBreak(activeAd.id);
                        }
                    }

                    player = new bitmovin.player.Player(playerContainer, conf);
                    player.load({
                        dash: '//bitmovin-a.akamaihd.net/content/MI201109210084_1/mpds/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.mpd',
                        hls: '//bitmovin-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8',
                        progressive: '//bitmovin-a.akamaihd.net/content/MI201109210084_1/MI201109210084_mpeg-4_hd_high_1080p25_10mbits.mp4',
                        poster: '//bitmovin-a.akamaihd.net/content/art-of-motion_drm/art-of-motion_poster.jpg'
                    });
                }

                (function () {
                    if (isAdblockEnabled) {
                        var blockerWrapperEl = document.getElementById('blocker-wrapper');
                        var blockerInfoEl = document.getElementById('blocker-info');
                        blockerInfoEl.innerHTML = '<b>Ad Blocker detected!</b> Ads may be blocked. Click here to see our server side ad insertion solution to bypass ad blockers.';
                        blockerWrapperEl.style.display = 'block';
                    }
                })();



                let adType = document.getElementById('adType').value;
                let manifestUrl = document.getElementById('ad-server-url').value;
                let schedule = document.getElementById('schedule-list').value;

                player.ads.schedule({
                    tag: {
                        url: manifestUrl,
                        type: adType
                    },
                    id: 'Ad',
                    position: schedule
                });
            </script>
        </div>
    </div>
</div>

